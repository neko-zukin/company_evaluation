<html>
<head>
	<meta charset="UTF-8">
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<link rel="stylesheet" href="style.css">
	<script src="DB_sql.js"></script>
</head>
<body>
	<h1>評価出力</h1>
	<!--<button>全選択</button>-->
	<table border="1" id="table">
		<tr>
			<th>社員番号</th>
			<th>氏名</th>
			<th>最新日</th>
			<th></th>
		</tr>
	</table>
	<button id="back_button">戻る</button>
	<button id="output_button">出力</button>
</body>
<script>
	let DB_staff = DB.sql("SELECT TM_staff.staff_id,staff_name,max(assess_date) as assess_date FROM TM_staff join TE_staff_sc on TM_staff.staff_id=te_staff_sc.staff_id Group by TM_staff.staff_id")
	let color_check = [DB_staff.length];
	for(i=0;i<color_check;i++){
		color_check[i] = false;
	}
	for(i=0;i<DB_staff.length;i++){
		$("#table").append('<tr><td id="row0_'+i+'">'+DB_staff[i]["staff_id"]+'</td><td id="row1_'+i+'">'+DB_staff[i]["staff_name"]+'</td><td id="row2_'+i+'">'+DB_staff[i]["assess_date"]+'</td><td id="no"><button id="'+i+'">確認</button></td></tr>');
	}
	
	$("td").click(function(){
		let td_id = $(this).attr("id");
		if(td_id!="no"){
			let row_id = td_id.slice(5);
			if(color_check[row_id]==false){
				$("#row0_"+row_id).css('background-color','yellow');
				$("#row1_"+row_id).css('background-color','yellow');
				$("#row2_"+row_id).css('background-color','yellow');
				color_check[row_id]=true;
			}else if(color_check){
				$("#row0_"+row_id).css('background-color','white');
				$("#row1_"+row_id).css('background-color','white');
				$("#row2_"+row_id).css('background-color','white');
				color_check[row_id]=false;
			}
		}
	})
	
	$("button").click(function(){
		let button_id = $(this).attr("id");
		if(button_id!="back_button"&&button_id!="output_button"&&button_id!="check_button"){
			let staff_id = DB_staff[button_id]["staff_id"];
			localStorage.setItem("ev_staff_id_check",staff_id);
			location.href='ev_check.html'
		}
	})
	
	$("#back_button").on("click",function(){
		location.href='ev_select.html'
	})

	$("#output_button").on("click",function(){
		alert("出力");
	})
	
</script>
</html>

